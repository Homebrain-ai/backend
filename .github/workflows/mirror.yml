name: Mirror to subedi-labs

on:
  push:
    branches: ["**"]
    tags: ["**"]
  workflow_dispatch:

jobs:
  mirror:
    runs-on: ubuntu-latest
    steps:
      - name: Mirror branches + tags (skip PR refs)
        env:
          DST_REPO: subedi-labs/homebrain-backend
          TOKEN: ${{ secrets.SUBEDI_LABS_AUTOMATION_TOKEN }}
        shell: bash
        run: |
          set -euo pipefail

          if [ -z "${TOKEN:-}" ]; then
            echo "ERROR: SUBEDI_LABS_AUTOMATION_TOKEN missing/empty"
            exit 1
          fi

          SRC="https://github.com/${GITHUB_REPOSITORY}.git"
          DST="https://x-access-token:${TOKEN}@github.com/${DST_REPO}.git"

          git clone --mirror "$SRC" repo.git
          cd repo.git

          git push --force "$DST" 'refs/heads/*:refs/heads/*'
          git push --force --tags "$DST"
